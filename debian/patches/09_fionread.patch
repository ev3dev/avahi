r1370 | lennart | 2007-01-06 17:10:01 +0100 (Sat, 06 Jan 2007) | 3 lines

* print a warning when FIONREAD returns an invalid size

Index: avahi-core/socket.c
===================================================================
--- avahi-core/socket.c	(revision 1369)
+++ avahi-core/socket.c	(revision 1370)
@@ -635,8 +649,10 @@
         goto fail;
     }
 
-    if (ms <= 0)
+    if (ms < 0) {
+        avahi_log_warn("FIONREAD returned negative value.");
         goto fail;
+    }
 
     p = avahi_dns_packet_new(ms + AVAHI_DNS_PACKET_EXTRA_SIZE);
 
@@ -779,8 +802,10 @@
         goto fail;
     }
 
-    if (ms <= 0)
+    if (ms < 0) {
+        avahi_log_warn("FIONREAD returned negative value.");
         goto fail;
+    }
     
     p = avahi_dns_packet_new(ms + AVAHI_DNS_PACKET_EXTRA_SIZE);
 
